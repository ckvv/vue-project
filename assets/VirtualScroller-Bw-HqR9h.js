import{i as C,t as F,d as $,u as j,r as T,c as p,a as g,b as x,e as i,n as b,F as z,f as H,g as M,o as y,h as I,w as N,j as w,v as W,k as R,l as S}from"./index-D5pOl4lT.js";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const B=()=>{};function Y(e,l){function n(...o){return new Promise((t,c)=>{Promise.resolve(e(()=>l.apply(this,o),{fn:l,thisArg:this,args:o})).then(t).catch(c)})}return n}function A(...e){let l=0,n,o=!0,t=B,c,u,s,r,h;!C(e[0])&&typeof e[0]=="object"?{delay:u,trailing:s=!0,leading:r=!0,rejectOnCancel:h=!1}=e[0]:[u,s=!0,r=!0,h=!1]=e;const k=()=>{n&&(clearTimeout(n),n=void 0,t(),t=B)};return d=>{const a=F(u),v=Date.now()-l,f=()=>c=d();return k(),a<=0?(l=Date.now(),f()):(v>a&&(r||!o)?(l=Date.now(),f()):s&&(c=new Promise((V,D)=>{t=h?D:V,n=setTimeout(()=>{l=Date.now(),o=!0,V(f()),k()},Math.max(0,a-v))})),!r&&!n&&(n=setTimeout(()=>o=!0,a)),o=!1,c)}}function P(e,l=200,n=!1,o=!0,t=!1){return Y(A(l,n,o,t),e)}const E=["data-key"],G=$({__name:"RecycleScroller3",props:{items:{},itemSize:{default:24},buffer:{default:0}},setup(e){const l=j("content"),n=T(new Map);function o(){if(l.value)for(let m=0;m<l.value.children.length;m++){const d=l.value.children[m],a=d.dataset.key;n.value.has(a)||n.value.set(a,d.getBoundingClientRect().height)}}const t=T(0),c=p(()=>e.items.slice(t.value,t.value+e.buffer));function u(m,d){return e.items.slice(m,d).reduce((a,v)=>{const f=`${v.key}`;return n.value.has(f)?a+n.value.get(f):a+e.itemSize},0)}const s=p(()=>u()),r=p(()=>u(0,t.value));function h(m){o();const d=m.target;if(d){const a=d.scrollTop;let v=0;for(let f=0;f<e.items.length;f++)if(v+=n.value.get(`${e.items[f].key}`)||e.itemSize,v>a||f===e.items.length-1){t.value=f;break}}}const k=P(h,200,!0);return(m,d)=>(y(),g("div",{class:"recycle-scroller",onScrollPassive:d[0]||(d[0]=(...a)=>x(k)&&x(k)(...a))},[i("div",{style:b({height:`${s.value}px`})},[i("div",{ref:"content",style:b({transform:`translateY(${r.value}px)`})},[(y(!0),g(z,null,H(c.value,(a,v)=>(y(),g("div",{key:a.key||v,class:"recycle-scroller-item","data-key":a.key||v},[M(m.$slots,"default",{item:a})],8,E))),128))],4)],4)],32))}}),L=$({__name:"RecycleScroller2",props:{items:{},itemSize:{},buffer:{default:0}},setup(e){const l=T(0),n=p(()=>e.items.slice(l.value,l.value+e.buffer)),o=p(()=>e.items.length*e.itemSize),t=p(()=>l.value*e.itemSize);function c(s){const r=s.target;r&&(l.value=Math.floor(r.scrollTop/e.itemSize))}const u=P(c,200,!0);return(s,r)=>(y(),g("div",{class:"recycle-scroller",onScrollPassive:r[0]||(r[0]=(...h)=>x(u)&&x(u)(...h))},[i("div",{style:b({height:`${o.value}px`})},[i("div",{style:b({transform:`translateY(${t.value}px)`})},[(y(!0),g(z,null,H(n.value,h=>M(s.$slots,"default",{item:h})),256))],4)],4)],32))}}),O=$({__name:"RecycleScroller",props:{items:{},itemSize:{},buffer:{default:0}},setup(e){const l=T(0),n=p(()=>e.items.slice(l.value,l.value+e.buffer)),o=p(()=>({top:l.value*e.itemSize,bottom:Math.max(e.items.length-e.buffer-l.value,0)*e.itemSize}));function t(u){const s=u.target;s&&(l.value=Math.floor(s.scrollTop/e.itemSize))}const c=P(t,200,!0);return(u,s)=>(y(),g("div",{class:"recycle-scroller",onScrollPassive:s[0]||(s[0]=(...r)=>x(c)&&x(c)(...r))},[i("div",{style:b({paddingTop:`${o.value.top}px`,paddingBottom:`${o.value.bottom}px`})},[(y(!0),g(z,null,H(n.value,r=>M(u.$slots,"default",{item:r})),256))],4)],32))}}),U={class:"color-red h-[24px]"},q={class:"color-red h-[24px]"},K=$({__name:"VirtualScroller",setup(e){const l=T(1e4),n=p(()=>Array.from({length:l.value}).map((o,t)=>({id:t,key:t,value:Math.random()})));return(o,t)=>{const c=O,u=L,s=G;return y(),g(z,null,[t[1]||(t[1]=I(" 虚拟滚动, 你可以打开调试页面查看实际渲染的元素 ")),N(i("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>l.value=r)},null,512),[[W,l.value]]),t[2]||(t[2]=i("h1",null,"动态更新 paddingTop paddingBottom 实现",-1)),w(c,{class:"h-[240px] overflow-auto",buffer:20,items:n.value,"item-size":24},{default:R(({item:r})=>[i("div",U,[i("span",null,S(r.id)+": "+S(r.value),1)])]),_:1},8,["items"]),t[3]||(t[3]=i("h1",null,"动态更新 translateY 实现",-1)),w(u,{class:"h-[240px] overflow-auto",buffer:20,items:n.value,"item-size":24},{default:R(({item:r})=>[i("div",q,[i("span",null,S(r.id)+": "+S(r.value),1)])]),_:1},8,["items"]),t[4]||(t[4]=i("h1",null,"不定高度虚拟列表实现",-1)),w(s,{class:"h-[440px] overflow-auto",buffer:30,items:n.value,"item-size":24},{default:R(({item:r})=>[i("div",{class:"color-red",style:b({height:`${r.value*100+22}px`})},[i("span",null,S(r.id)+": "+S(r.value),1)],4)]),_:1},8,["items"])],64)}}});export{K as default};
