import{i as z,t as C,d as V,u as F,r as S,c as y,o as g,a as k,b as m,n as w,F as $,e as j,f as x,g as B,h as H,w as M,v as P,j as N,k as W,l as b}from"./index-D9ONNdJa.js";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const R=()=>{};function A(r,n){function t(...a){return new Promise((e,f)=>{Promise.resolve(r(()=>n.apply(this,a),{fn:n,thisArg:this,args:a})).then(e).catch(f)})}return t}function E(...r){let n=0,t,a=!0,e=R,f,o,v,d,h;!z(r[0])&&typeof r[0]=="object"?{delay:o,trailing:v=!0,leading:d=!0,rejectOnCancel:h=!1}=r[0]:[o,v=!0,d=!0,h=!1]=r;const p=()=>{t&&(clearTimeout(t),t=void 0,e(),e=R)};return s=>{const l=C(o),c=Date.now()-n,u=()=>f=s();return p(),l<=0?(n=Date.now(),u()):(c>l&&(d||!a)?(n=Date.now(),u()):v&&(f=new Promise((T,D)=>{e=h?D:T,t=setTimeout(()=>{n=Date.now(),a=!0,T(u()),p()},Math.max(0,l-c))})),!d&&!t&&(t=setTimeout(()=>a=!0,l)),a=!1,f)}}function G(r,n=200,t=!1,a=!0,e=!1){return A(E(n,t,a,e),r)}const L=["data-key"],I=V({__name:"RecycleScroller3",props:{items:{},itemSize:{default:24},buffer:{default:0}},setup(r){const n=F("content"),t=S(new Map);function a(){if(n.value)for(let i=0;i<n.value.children.length;i++){const s=n.value.children[i],l=s.dataset.key;t.value.has(l)||t.value.set(l,s.getBoundingClientRect().height)}}const e=S(0),f=y(()=>r.items.slice(e.value,e.value+r.buffer));function o(i,s){return r.items.slice(i,s).reduce((l,c)=>{const u=`${c.key}`;return t.value.has(u)?l+t.value.get(u):l+r.itemSize},0)}const v=y(()=>o()),d=y(()=>o(0,e.value));function h(i){a();const s=i.target;if(s){const l=s.scrollTop;let c=0;for(let u=0;u<r.items.length;u++)if(c+=t.value.get(`${r.items[u].key}`)||r.itemSize,c>l){e.value=u;break}}}const p=G(h,200,!0);return(i,s)=>(g(),k("div",{class:"recycle-scroller",onScrollPassive:s[0]||(s[0]=(...l)=>x(p)&&x(p)(...l))},[m("div",{style:w({height:`${v.value}px`})},[m("div",{ref:"content",style:w({transform:`translateY(${d.value}px)`})},[(g(!0),k($,null,j(f.value,(l,c)=>(g(),k("div",{key:l.key||c,class:"recycle-scroller-item","data-key":l.key||c},[B(i.$slots,"default",{item:l})],8,L))),128))],4)],4)],32))}}),U=V({__name:"VirtualScroller",setup(r){const n=S(1e4),t=y(()=>Array.from({length:n.value}).map((a,e)=>({id:e,key:e,value:Math.random()})));return(a,e)=>{const f=I;return g(),k($,null,[e[1]||(e[1]=H(" 虚拟滚动, 你可以打开调试页面查看实际渲染的元素 ")),M(m("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.value=o)},null,512),[[P,n.value]]),e[2]||(e[2]=m("h1",null,"不定高度虚拟列表实现",-1)),N(f,{class:"h-[440px] overflow-auto",buffer:30,items:t.value,"item-size":24},{default:W(({item:o})=>[m("div",{class:"color-red",style:w({height:`${o.value*100+22}px`})},[m("span",null,b(o.id)+": "+b(o.value),1)],4)]),_:1},8,["items"])],64)}}});export{U as default};
