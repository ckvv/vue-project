import{i as C,t as F,d as R,u as $,r as V,c as y,o as g,a as k,b as m,n as S,F as D,e as j,f as T,g as B,h as H,w as M,v as P,j as N,k as W,l as x}from"./index-HXgkn-aX.js";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const b=()=>{};function A(l,r){function t(...o){return new Promise((e,f)=>{Promise.resolve(l(()=>r.apply(this,o),{fn:r,thisArg:this,args:o})).then(e).catch(f)})}return t}function E(...l){let r=0,t,o=!0,e=b,f,a,h,d,p;!C(l[0])&&typeof l[0]=="object"?{delay:a,trailing:h=!0,leading:d=!0,rejectOnCancel:p=!1}=l[0]:[a,h=!0,d=!0,p=!1]=l;const v=()=>{t&&(clearTimeout(t),t=void 0,e(),e=b)};return s=>{const n=F(a),c=Date.now()-r,i=()=>f=s();return v(),n<=0?(r=Date.now(),i()):(c>n&&(d||!o)?(r=Date.now(),i()):h&&(f=new Promise((w,z)=>{e=p?z:w,t=setTimeout(()=>{r=Date.now(),o=!0,w(i()),v()},Math.max(0,n-c))})),!d&&!t&&(t=setTimeout(()=>o=!0,n)),o=!1,f)}}function G(l,r=200,t=!1,o=!0,e=!1){return A(E(r,t,o,e),l)}const L=["data-key"],I=R({__name:"RecycleScroller3",props:{items:{},itemSize:{},buffer:{default:0}},setup(l){const r=$("content"),t=new Map;function o(){if(r.value){for(let u=0;u<r.value.children.length;u++){const s=r.value.children[u],n=s.dataset.key;t.has(n)||t.set(n,s.getBoundingClientRect().height)}console.log(t)}}const e=V(0),f=y(()=>l.items.slice(e.value,e.value+l.buffer));function a(u,s){return l.items.slice(u,s).reduce((n,c)=>{const i=c.key||c;return t.has(i)?n+t.get(i):n+l.itemSize},0)}const h=y(()=>a()),d=y(()=>a(0,e.value));function p(u){const s=u.target;if(s){const n=s.scrollTop;let c=0;for(let i=0;i<l.items.length;i++)if(c+=t.get(l.items[i].key)||l.itemSize,c>n){e.value=i;break}}o()}const v=G(p,200,!0);return(u,s)=>(g(),k("div",{class:"recycle-scroller",onScrollPassive:s[0]||(s[0]=(...n)=>T(v)&&T(v)(...n))},[m("div",{style:S({height:`${h.value}px`})},[m("div",{ref:"content",style:S({transform:`translateY(${d.value}px)`})},[(g(!0),k(D,null,j(f.value,(n,c)=>(g(),k("div",{class:"recycle-scroller-item","data-key":n.key||c},[B(u.$slots,"default",{item:n})],8,L))),256))],4)],4)],32))}}),U=R({__name:"VirtualScroller",setup(l){const r=V(1e4),t=y(()=>Array.from({length:r.value}).map((o,e)=>({id:e,key:e,value:Math.random()})));return(o,e)=>{const f=I;return g(),k(D,null,[e[1]||(e[1]=H(" 虚拟滚动, 你可以打开调试页面查看实际渲染的元素 ")),M(m("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>r.value=a)},null,512),[[P,r.value]]),e[2]||(e[2]=m("h1",null,"不定高度虚拟列表实现",-1)),N(f,{class:"h-[440px] overflow-auto",buffer:30,items:t.value,"item-size":24},{default:W(({item:a})=>[m("div",{class:"color-red",style:S({height:`${a.value*100+22}px`})},[m("span",null,x(a.id)+": "+x(a.value),1)],4)]),_:1},8,["items"])],64)}}});export{U as default};
